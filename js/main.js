var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6-impl","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var e=a[f];if(b.call(c,e,f,a))return{i:f,v:e}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
(function(a){if("function"===typeof define&&define.amd)define(a);else if("object"===typeof exports)module.exports=a();else{var b=window.Cookies,c=window.Cookies=a();c.noConflict=function(){window.Cookies=b;return c}}})(function(){function a(){for(var a=0,d={};a<arguments.length;a++){var b=arguments[a],e;for(e in b)d[e]=b[e]}return d}function b(c){function d(b,e,g){var f;if("undefined"!==typeof document){if(1<arguments.length){g=a({path:"/"},d.defaults,g);if("number"===typeof g.expires){var h=new Date;
h.setMilliseconds(h.getMilliseconds()+864E5*g.expires);g.expires=h}try{f=JSON.stringify(e),/^[\{\[]/.test(f)&&(e=f)}catch(q){}e=c.write?c.write(e,b):encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);b=encodeURIComponent(String(b));b=b.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);b=b.replace(/[\(\)]/g,escape);return document.cookie=[b,"=",e,g.expires&&"; expires="+g.expires.toUTCString(),g.path&&"; path="+g.path,g.domain&&
"; domain="+g.domain,g.secure?"; secure":""].join("")}b||(f={});for(var h=document.cookie?document.cookie.split("; "):[],m=/(%[0-9A-Z]{2})+/g,n=0;n<h.length;n++){var r=h[n].split("="),l=r.slice(1).join("=");'"'===l.charAt(0)&&(l=l.slice(1,-1));try{var p=r[0].replace(m,decodeURIComponent),l=c.read?c.read(l,p):c(l,p)||l.replace(m,decodeURIComponent);if(this.json)try{l=JSON.parse(l)}catch(q){}if(b===p){f=l;break}b||(f[p]=l)}catch(q){}}return f}}d.set=d;d.get=function(a){return d(a)};d.getJSON=function(){return d.apply({json:!0},
[].slice.call(arguments))};d.defaults={};d.remove=function(c,b){d(c,"",a(b,{expires:-1}))};d.withConverter=b;return d}return b(function(){})});var SCALE_SEMITONES_NUMBER=12,MAX_HALF_STEP=11,MIN_HALF_STEP=-11,MAX_STRINGS_NUMBER=12,MIN_STRINGS_NUMBER=3,MAX_ITEMS_NUMBER=5,FRETS_NUMBER=24,DEFAULT_METR_BEATS=4,DEFAULT_METR_BEAT_VAL=4,DEFAULT_METR_VOLUME=50,DEFAULT_METR_TEMPO=120,MIN_BEATS=1,MAX_BEATS=16,MIN_BEAT_VAL=1,MAX_BEAT_VAL=32,MIN_TEMPO=40,MAX_TEMPO=320,DEFAULT_SCALE_OPTIONS_EXPIRE_DAYS=30,DEFAULT_NOTES_SHOW_PATTERN=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],DEFAULT_TRIADS_SHOW_PATTERN=[!0,!1,!0,!1,!0,!1,!1,!1,!1,!1,!1,!1],NOTES="C C# D D# E F F# G G# A A# B".split(" "),
DEFAULT_SCALE_SEMITONES=[2,2,1,2,2,2,1],DEFAULT_STRING_TUNES="E B G D A E B F# C# G# D# A#".split(" "),DEFAULT_SCALE_NOTES="CDEFGAB".split(""),SCALES={major:[2,2,1,2,2,2,1],aeolian:[2,2,1,2,2,2,1],minor:[2,1,2,2,1,2,2],ionian:[2,1,2,2,1,2,2],harmonic_min:[2,1,2,2,1,3,1],chromatic:[1,1,1,1,1,1,1,1,1,1,1,1],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],myxolydian:[2,2,1,2,2,1,2],locrian:[1,2,2,1,2,2,2],melodic_min:[2,1,2,2,2,2,1],alt_dom:[1,2,1,2,2,2,2],sup_locrian:[1,2,1,2,
2,2,2],dim_whole_tone:[1,2,1,2,2,2,2],alt_scale:[1,2,1,2,2,2,2],blues_min_hex:[3,2,1,1,3,2],blues_pent:[3,2,1,4,2],blues:[3,2,1,1,3,1,1],major_pent:[2,2,3,2,3],suspended_pent:[2,3,2,3,2],dorian_pent:[2,3,2,3,2],phrygian_pent:[3,2,3,2,2],myxolydian_pent:[2,3,2,2,3],aeolian_pent:[3,2,2,3,2],minor_pent:[3,2,2,3,2],major_beb:[2,2,1,2,1,1,2,1],minor_beb:[2,1,1,1,2,2,1,2],dom_beb:[2,2,1,2,2,1,1,1],dorian_beb:[2,1,1,1,2,2,1,2],whole_tone:[2,2,2,2,2,2],whole_half_tone:[2,1,2,1,2,1,2,1],half_whole_tone:[1,
2,1,2,1,2,1,2],dim:[2,1,2,1,2,1,2,1],dom_dim:[1,2,1,2,1,2,1,2],symm_dim:[1,2,1,2,1,2,1,2],spanish:[1,2,2,2,1,2,2],acoustic:[2,2,2,1,2,1,2],bartok:[2,2,2,1,2,1,2]},TUNINGS={standart_e:"E B G D A E B F# C# G# D# A#".split(" "),standart_e_bass:["G","D","A","E","B"],drop_d_6:"E B G D A D B F# C# G# D# A#".split(" "),drop_a_7:"E B G D A E A F# C# G# D# A#".split(" "),drop_e_8:"E B G D A E B E C# G# D# A#".split(" ")},CUSTOM_TUNING_VALUE="custom",ITEM_CLASS="item_block",STRING_NUMBER_CLASS="strings_number",
SCALE_SELECT_CLASS="scale_select",FRETBOARD_CLASS="fretboard",HOR_FRET_CLASS="fret_hor",NULL_VER_FRET_CLASS="fret_null",VER_FRET_CLASS="fret_ver",NOTE_CLASS="note",NORMAL_NOTE_CLASS="normal_note",HIGHLIGHTED_NOTE_CLASS="highlighted_note",TRANSPARENT_NOTE_CLASS="transparent_note",HIDDEN_NOTE_CLASS="hidden_note",STRINGS_OPTIONS_BLOCK_CLASS="strings_options_block",STRING_TUNE_BLOCK_CLASS="string_tune",STRING_TUNE_SELECT_CLASS="string_tune_select",LEFT_ARROW_CLASS="left_arrow",RIGHT_ARROW_CLASS="right_arrow",
HALF_STEP_BLOCK_CLASS="half_step_block",HALF_STEP_SELECT_CLASS="half_step_select",TUNING_SELECT_CLASS="tuning_select",ROOT_NOTE_CLASS="root_note",SELECTED_TEXT_CLASS="selected_text",SCALE_NOTES_BLOCK_CLASS="scale_notes_and_semitones_block",SCALE_NOTES_CLASS="scale_notes",SCALE_NOTE_CLASS="scale_note",SCALE_NOTE_TEXT_CLASS="scale_note_text",ADD_STRING_BTN_CLASS="add_string",DEL_STRING_BTN_CLASS="delete_string",CLOSE_BTN_CLASS="close_btn",SET_DEFAULT_BTN_CLASS="set_default_btn",TRIADS_CHECKBOX_CLASS=
"triads_checkbox",TRIADS_CHECKBOX_EMPTY_CLASS="triads_checkbox_empty",METRONOME_DISABLED_ID="metronome_disabled_block",ADD_NEW_ITEM_BTN_ID="add_new_item_btn",METR_PLAY_BTN_ID="metronome_play_btn",METR_STOP_BTN_ID="metronome_stop_btn",METR_VOLUME_RANGE_ID="metronome_volume_range",METR_TEMPO_RANGE_ID="metronome_tempo_range",METR_TEMPO_INPUT_ID="metronome_tempo_input",METR_TEMPO_LEFT_ARROW_ID="metronome_tempo_left_arrow",METR_TEMPO_RIGHT_ARROW_ID="metronome_tempo_right_arrow",METR_BEATS_SELECT_ID="metronome_beats_select",
METR_BEATS_LEFT_ARROW_ID="metronome_beats_left_arrow",METR_BEATS_RIGHT_ARROW_ID="metronome_beats_right_arrow",METR_BEAT_VAL_SELECT_ID="metronome_beat_val_select",METR_BEAT_VAL_LEFT_ARROW_ID="metronome_beat_val_left_arrow",METR_BEAT_VAL_RIGHT_ARROW_ID="metronome_beat_val_right_arrow",WRONG_SEMITONE_NUMBER_MSG="Wrong sum of semitones, must be equal to "+SCALE_SEMITONES_NUMBER,WRONG_ROOT_NOTE_MSG="Wrong root note",WRONG_NOTE_MSG="Wrong note",WRONG_SCALE_NAME_MSG="Wrong scale name (value)",WRONG_STRING_TUNE_NOTE_MSG=
"Wrong string tune note",WRONG_TUNING_NAME="Wrong tuning name (value)",WEB_AUDIO_INIT_ERR_MSG="Web audio initialization error",WORKER_INIT_ERR_MSG="Web worker initialization error",PARAMS_ATOB_ERROR_MSG="GET parameter cannot be decoded",SCALE_NOTES_TMPL=doT.template($("#scale_notes_tmpl").html()),STRING_VER_FRET_TMPL=doT.template($("#string_ver_fret_tmpl").html()),STRING_FRET_TMPL=doT.template($("#string_hor_fret_tmpl").html()),STRING_FRET_MARK_TMPL=doT.template($("#fretboard_single_mark").html()),
STRING_DOUBLE_FRET_MARK_TMPL=doT.template($("#fretboard_double_mark").html()),STRING_TUNE_BLOCK_TMPL=doT.template($("#string_tune_block_tmpl").html()),SCALES_ITEM_BLOCK_TMPL=doT.template($("#scales_item_tmpl").html());function isCorrectNote(a){if("string"!==typeof a)return!1;var b=!1;0<=NOTES.indexOf(a.toUpperCase())?b=!0:console.log(a+": "+WRONG_NOTE_MSG);return b}function isCorrectSemitonesSum(a){if("object"!==typeof a||!Array.isArray(a))return!1;for(var b=!1,c=0,d=0;d<a.length;d++)c+=a[d];c==SCALE_SEMITONES_NUMBER?b=!0:console.log(a+": "+WRONG_SEMITONE_NUMBER_MSG);return b}
function isCorrectScale(a){if("string"!==typeof a)return!1;var b=!1,c=SCALES[a];void 0!==c?b=isCorrectSemitonesSum(c):console.log(a+": "+WRONG_SCALE_NAME_MSG);return b}function isCorrectTuningNotes(a){if("object"!==typeof a||!Array.isArray(a))return!1;for(var b=!1,c=0;c<a.length&&(b=isCorrectNote(a[c]),b);c++);return b}
function isCorrectTuning(a){if("string"!==typeof a)return!1;var b=!1;if(a==CUSTOM_TUNING_VALUE)b=!0;else{var c=TUNINGS[a];void 0!==c?b=isCorrectTuningNotes(c):console.log(a+": "+WRONG_TUNING_NAME)}return b}function isCorrectHalfStep(a){return Number.isInteger(a)&&+a>=MIN_HALF_STEP&&+a<=MAX_HALF_STEP}function isCorrectStringsNumber(a){return Number.isInteger(a)&&+a>=MIN_STRINGS_NUMBER&&+a<=MAX_STRINGS_NUMBER}
function isCorrectNotesShowPattern(a){var b="object"===typeof a&&Array.isArray(a);if(!b)return!1;var c=a.every(function(a){return"boolean"===typeof a});if(!c)return!1;a=12==a.length;return b&&c&&a}function getScaleSemitones(a){a=a.toLowerCase();var b=DEFAULT_SCALE_SEMITONES;isCorrectScale(a)&&(b=SCALES[a]);return b}function getTuneNotes(a){a=a.toLowerCase();var b=DEFAULT_STRING_TUNES;isCorrectTuning(a)&&(b=TUNINGS[a].slice());return b}
function prevNote(a){resultNote="C";isCorrectNote(a)&&(a=NOTES.indexOf(a),a--,0>a&&(a=NOTES.length-1),resultNote=NOTES[a]);return resultNote}function nextNote(a){resultNote="C";isCorrectNote(a)&&(a=NOTES.indexOf(a),a++,a==NOTES.length&&(a=0),resultNote=NOTES[a]);return resultNote}function nextNoteAfterSemiTones(a,b){var c=a;if(0<b)for(var d=0;d<b;d++)c=nextNote(c);else for(d=0;d>b;d--)c=prevNote(c);return c}function prevHalfStep(a){a--;a<MIN_HALF_STEP&&(a=MIN_HALF_STEP);return a}
function nextHalfStep(a){a++;a>MAX_HALF_STEP&&(a=MAX_HALF_STEP);return a}function getNotesFromSemiTones(a,b){var c=DEFAULT_SCALE_NOTES;a=a.toUpperCase();if(isCorrectNote(a)&&isCorrectSemitonesSum(b)){var c=[],d=a;c.push(d);for(var f=0;f<b.length;f++){for(var e=1;e<=b[f];e++)d=nextNote(d);c.push(d)}c.pop()}return c}
function getSemiTonesPatternForString(a,b,c){for(var d=[],f=0,e=a.indexOf(c);0>e;)c=nextNote(c),e=a.indexOf(c),f++;d.push(f);for(a=e;a<b.length;a++)d.push(b[a]);for(a=0;a<e;a++)d.push(b[a]);return d}function sliderLogVal(a,b,c){var d=0;0<a&&(b=Math.log(b),d=Math.exp(b+(Math.log(c)-b)/100*(a-0)));return d}function semiTonesPatternBoolToInt(a,b){if(isCorrectNotesShowPattern(b))for(var c=0;c<b.length;c++)b[c]=b[c]?1:0;return b}
function semiTonesPatternIntToBool(a,b){var c="object"===typeof b&&Array.isArray(b);if(!c)return b;var d=b.every(function(a){return Number.isInteger(a)});if(!d)return b;var f=12==b.length;if(c&&d&&f)for(c=0;c<b.length;c++)b[c]=0===b[c]?!1:!0;return b};var audioCtx,worker,isMetronomeCanWork=!0;try{audioCtx=new AudioContext}catch(a){console.log(WEB_AUDIO_INIT_ERR_MSG),isMetronomeCanWork=!1}try{worker=new Worker("js/worker.js")}catch(a){console.log(WORKER_INIT_ERR_MSG),isMetronomeCanWork=!1}
var metronome={beats:DEFAULT_METR_BEATS,beatValue:DEFAULT_METR_BEAT_VAL,volume:sliderLogVal(DEFAULT_METR_VOLUME,1,100)/100,tempo:DEFAULT_METR_TEMPO,beatNumber:0,beatsQueue:[],$playBtn:$("#"+METR_PLAY_BTN_ID),$stopBtn:$("#"+METR_STOP_BTN_ID),$volumeRange:$("#"+METR_VOLUME_RANGE_ID),$tempoRange:$("#"+METR_TEMPO_RANGE_ID),$tempoInput:$("#"+METR_TEMPO_INPUT_ID),$tempoLeftArrow:$("#"+METR_TEMPO_LEFT_ARROW_ID),$tempoRightArrow:$("#"+METR_TEMPO_RIGHT_ARROW_ID),$beatsSelect:$("#"+METR_BEATS_SELECT_ID),$beatsLeftArrow:$("#"+
METR_BEATS_LEFT_ARROW_ID),$beatsRightArrow:$("#"+METR_BEATS_RIGHT_ARROW_ID),$beatValSelect:$("#"+METR_BEAT_VAL_SELECT_ID),$beatValLeftArrow:$("#"+METR_BEAT_VAL_LEFT_ARROW_ID),$beatValRightArrow:$("#"+METR_BEAT_VAL_RIGHT_ARROW_ID),scheduleBeatFromQueue:function(){if(0<this.beatsQueue.length){beat=this.beatsQueue.shift();var a=audioCtx.createOscillator();a.type="square";var b=440;0==this.beatNumber&&(b=640);a.frequency.value=b;a.connect(this.gainNode);a.start(beat.time);a.stop(beat.time+50/b)}},beatsScheduler:function(){itemThis=
metronome;if(0<itemThis.beatsQueue.length){var a=itemThis.beatsQueue[itemThis.beatsQueue.length-1],b=240/itemThis.beatValue/itemThis.tempo;audioCtx.currentTime+b>=a.time&&(itemThis.beatsQueue.push({time:a.time+b,number:itemThis.beatNumber}),itemThis.scheduleBeatFromQueue(),itemThis.beatNumber=(itemThis.beatNumber+1)%itemThis.beats)}else itemThis.beatsQueue.push({time:audioCtx.currentTime,number:itemThis.beatNumber})},onPlayBtn:function(a){itemThis=a.data.itemThis;$(this).hide();itemThis.$stopBtn.show();
itemThis.beatNumber=0;worker.postMessage("start")},onStopBtn:function(a){itemThis=a.data.itemThis;itemThis.beatsQueue=[];$(this).hide();itemThis.$playBtn.show();worker.postMessage("stop")},onVolumeChange:function(a){itemThis=a.data.itemThis;a=$(this).val();a=sliderLogVal(+a,1,100);a/=100;itemThis.gainNode.gain.value=a;itemThis.volume=a},onTempoChange:function(a){itemThis=a.data.itemThis;a=$(this).val();itemThis.$tempoInput.val(a);itemThis.tempo=+a},onTempoInputChange:function(a){itemThis=a.data.itemThis;
a=$(this).val().replace(/[^,.0-9]/gim,"").replace(/[,.]+/gim,".");a=parseFloat(a);a<MIN_TEMPO?a=MIN_TEMPO:a>MAX_TEMPO&&(a=MAX_TEMPO);itemThis.tempo=a;$(this).val(a);itemThis.$tempoRange.val(a)},onTempoLeftArrow:function(a){itemThis=a.data.itemThis;a=itemThis.$tempoInput.val();a>MIN_TEMPO&&(a--,itemThis.tempo=a,itemThis.$tempoInput.val(a),itemThis.$tempoRange.val(a))},onTempoRightArrow:function(a){itemThis=a.data.itemThis;a=itemThis.$tempoInput.val();a<MAX_TEMPO&&(a++,itemThis.tempo=a,itemThis.$tempoInput.val(a),
itemThis.$tempoRange.val(a))},onBeatsChange:function(a){itemThis=a.data.itemThis;a=$(this).val();itemThis.beats=+a},onBeatsLeftArrow:function(a){itemThis=a.data.itemThis;a=itemThis.beats;a<=MIN_BEATS||(a--,itemThis.beats=a,itemThis.$beatsSelect.find("[value='"+a+"']").prop("selected",!0))},onBeatsRightArrow:function(a){itemThis=a.data.itemThis;a=itemThis.beats;a>=MAX_BEATS||(a++,itemThis.beats=a,itemThis.$beatsSelect.find("[value='"+a+"']").prop("selected",!0))},onBeatValChange:function(a){itemThis=
a.data.itemThis;a=$(this).val();itemThis.beatValue=+a},onBeatValLeftArrow:function(a){itemThis=a.data.itemThis;a=itemThis.beatValue;a<=MIN_BEAT_VAL||(a/=2,itemThis.beatValue=a,itemThis.$beatValSelect.find("[value='"+a+"']").prop("selected",!0))},onBeatValRightArrow:function(a){itemThis=a.data.itemThis;a=itemThis.beatValue;a>=MAX_BEAT_VAL||(a*=2,itemThis.beatValue=a,itemThis.$beatValSelect.find("[value='"+a+"']").prop("selected",!0))},workerTick:function(a){var b=metronome;"tick"==a.data&&b.beatsScheduler()},
init:function(){this.$stopBtn.hide();this.tempo=+this.$tempoRange.val();this.volume=sliderLogVal(+this.$volumeRange.val(),1,100)/100;this.gainNode=audioCtx.createGain();this.gainNode.gain.value=this.volume;this.gainNode.connect(audioCtx.destination);worker.onmessage=this.workerTick;this.$tempoInput.val(this.tempo);this.beats=this.$beatsSelect.val();this.beatValue=this.$beatValSelect.val();this.$playBtn.click({itemThis:this},this.onPlayBtn);this.$stopBtn.click({itemThis:this},this.onStopBtn);this.$volumeRange.change({itemThis:this},
this.onVolumeChange);this.$volumeRange.on("input",{itemThis:this},this.onVolumeChange);this.$tempoRange.change({itemThis:this},this.onTempoChange);this.$tempoRange.on("input",{itemThis:this},this.onTempoChange);this.$tempoInput.change({itemThis:this},this.onTempoInputChange);this.$tempoLeftArrow.click({itemThis:this},this.onTempoLeftArrow);this.$tempoRightArrow.click({itemThis:this},this.onTempoRightArrow);this.$beatsSelect.change({itemThis:this},this.onBeatsChange);this.$beatsLeftArrow.click({itemThis:this},
this.onBeatsLeftArrow);this.$beatsRightArrow.click({itemThis:this},this.onBeatsRightArrow);this.$beatValSelect.change({itemThis:this},this.onBeatValChange);this.$beatValLeftArrow.click({itemThis:this},this.onBeatValLeftArrow);this.$beatValRightArrow.click({itemThis:this},this.onBeatValRightArrow)}};var defaultScaleItemOptions={scale:"major",root:"C",tuning:"standart_e",halfStep:0,stringsTunes:DEFAULT_STRING_TUNES,stringsNumber:6,isTriadMode:!1,normalNotesShowPattern:DEFAULT_NOTES_SHOW_PATTERN,triadsNotesShowPattern:DEFAULT_TRIADS_SHOW_PATTERN};
function getDefaultScaleOptionsFromCookie(){if(void 0!==Cookies.getJSON("defaultScaleOptions")){var a=Cookies.getJSON("defaultScaleOptions");void 0!==a.scale&&isCorrectScale(a.scale)&&(defaultScaleItemOptions.scale=a.scale);void 0!==a.root&&isCorrectNote(a.root)&&(defaultScaleItemOptions.root=a.root);void 0!==a.tuning&&isCorrectTuning(a.tuning)&&(defaultScaleItemOptions.tuning=a.tuning);void 0!==a.halfStep&&isCorrectHalfStep(a.halfStep)&&(defaultScaleItemOptions.halfStep=+a.halfStep);void 0!==a.stringsTunes&&
isCorrectTuningNotes(a.stringsTunes)&&(defaultScaleItemOptions.stringsTunes=a.stringsTunes);void 0!==a.stringsNumber&&isCorrectStringsNumber(a.stringsNumber)&&(defaultScaleItemOptions.stringsNumber=+a.stringsNumber);void 0!==a.isTriadMode&&"boolean"===typeof a.isTriadMode&&(defaultScaleItemOptions.isTriadMode=a.isTriadMode);void 0!==a.normalNotesShowPattern&&isCorrectNotesShowPattern(a.normalNotesShowPattern)&&(defaultScaleItemOptions.normalNotesShowPattern=a.normalNotesShowPattern);void 0!==a.triadsNotesShowPattern&&
isCorrectNotesShowPattern(a.triadsNotesShowPattern)&&(defaultScaleItemOptions.triadsNotesShowPattern=a.triadsNotesShowPattern)}}
function isCorrectScalesJSONfields(a){var b=!1,c=!0,d={};try{d=JSON.parse(a,semiTonesPatternIntToBool)}catch(f){c=!1}c&&(b="scales"==d.t&&isCorrectScale(d.s)&&isCorrectNote(d.r)&&isCorrectTuning(d.tn)&&isCorrectHalfStep(d.hs)&&isCorrectTuningNotes(d.strt)&&isCorrectStringsNumber(d.strn)&&"boolean"===typeof d.tr&&isCorrectNotesShowPattern(d.np)&&isCorrectNotesShowPattern(d.tp));return b}
function ScalesItem(a,b){this.type="scales";this.id=a;this.scale="major";this.root="C";this.semiTones=DEFAULT_SCALE_SEMITONES;this.scaleNotes=DEFAULT_SCALE_NOTES;this.tuning="standart_e";this.halfStep=0;this.stringsNumber=3;this.stringsTunes=DEFAULT_STRING_TUNES;this.isTriadMode=!1;this.normalNotesShowPattern=DEFAULT_NOTES_SHOW_PATTERN;this.triadsNotesShowPattern=DEFAULT_TRIADS_SHOW_PATTERN;this.notesBlocks=[];this.putNotesOnString=function(a){var c=this.getTuneForString(a),b=getSemiTonesPatternForString(this.scaleNotes,
this.semiTones,c),e=$(this.notesBlocks[a]);e.toggleClass(HIDDEN_NOTE_CLASS,!0);e.toggleClass(TRANSPARENT_NOTE_CLASS,!1);for(var g=b.shift(),c=nextNoteAfterSemiTones(c,g),k=0;g<e.length;){var h=$(this.notesBlocks[a][g]);h.toggleClass(HIDDEN_NOTE_CLASS,!1);var m=this.scaleNotes.indexOf(c),n;this.isTriadMode?(n=!this.triadsNotesShowPattern[m],h.text(m+1)):(n=!this.normalNotesShowPattern[m],h.text(c));n&&h.toggleClass(TRANSPARENT_NOTE_CLASS,!0);m=c==this.root;h.toggleClass(NORMAL_NOTE_CLASS,!m).toggleClass(HIGHLIGHTED_NOTE_CLASS,
m);g+=b[k];c=nextNoteAfterSemiTones(c,b[k]);k=++k%b.length}};this.putNotesOnAllStrings=function(){for(var a=0;a<this.stringsNumber;a++)this.putNotesOnString(a)};this.incStringsNumber=function(){this.stringsNumber++;this.$stringsNumberBlock.text(""+this.stringsNumber)};this.decStringsNumber=function(){this.stringsNumber--;this.$stringsNumberBlock.text(""+this.stringsNumber)};this.getTuneForString=function(a){return this.stringsTunes[a%this.stringsTunes.length]};this.addString=function(a){var c=this.getTuneForString(a),
b=$("."+STRINGS_OPTIONS_BLOCK_CLASS,this.$itemBlock).append(STRING_TUNE_BLOCK_TMPL()).children().last();$("."+STRING_TUNE_SELECT_CLASS+" :contains('"+c+"')",b).prop("selected",!0);for(var c={currentStringNumber:a+1},e=$("."+NULL_VER_FRET_CLASS+", ."+VER_FRET_CLASS,this.$fretboardBlock),g,k,h=0;h<e.length;h++)g=$(STRING_FRET_TMPL(c)).appendTo(e[h]),g=$("."+NOTE_CLASS,g)[0],void 0===this.notesBlocks[a]&&(this.notesBlocks[a]=[]),this.notesBlocks[a][h]=g,0==a&&(k=h%12,g=3==k||5==k||7==k||9==k,k=0!=h&&
0==k,g?$(e[h]).append(STRING_FRET_MARK_TMPL()):k&&$(e[h]).append(STRING_DOUBLE_FRET_MARK_TMPL()));this.putNotesOnString(a);$("."+STRING_TUNE_SELECT_CLASS,b).change({itemThis:this},this.onStringTuneChange);$("."+LEFT_ARROW_CLASS,b).click({itemThis:this},this.onLeftArrowTuneClick);$("."+RIGHT_ARROW_CLASS,b).click({itemThis:this},this.onRightArrowTuneClick)};this.delLastString=function(){$("."+STRING_TUNE_BLOCK_CLASS,this.$itemBlock).last().remove();for(var a=$("."+NULL_VER_FRET_CLASS+", ."+VER_FRET_CLASS,
this.$fretboardBlock),b=0;b<a.length;b++)$("."+HOR_FRET_CLASS,$(a[b])).last().remove()};this.selectCurrentStringsTunes=function(){for(var a=$("."+STRINGS_OPTIONS_BLOCK_CLASS,this.$itemBlock),b=0;b<this.stringsNumber;b++)a.find("."+STRING_TUNE_SELECT_CLASS+":eq("+b+") :contains('"+this.getTuneForString(b)+"')").prop("selected",!0)};this.selectCurrentTuning=function(){this.$itemBlock.find("."+TUNING_SELECT_CLASS+" [value='"+this.tuning+"']").prop("selected",!0)};this.selectCurrentScale=function(){$("."+
SCALE_SELECT_CLASS+" [value='"+this.scale+"']",this.$itemBlock).prop("selected",!0)};this.selectCurrentHalfStep=function(){$("."+HALF_STEP_SELECT_CLASS+" [value='"+this.halfStep+"']",this.$itemBlock).prop("selected",!0)};this.moveTuning=function(a){for(var c=0;c<this.stringsTunes.length;c++)this.stringsTunes[c]=nextNoteAfterSemiTones(this.stringsTunes[c],a)};this.changeScaleNotesBlock=function(){$("."+SCALE_NOTES_CLASS,this.$itemBlock).remove();var a=this.scaleNotes.slice();a.push(this.root);a={root:this.root,
semiTones:this.semiTones,notes:a};$("."+SCALE_NOTES_BLOCK_CLASS,this.$itemBlock).append(SCALE_NOTES_TMPL(a));for(var a=$("."+SCALE_NOTES_CLASS,this.$itemBlock).find("."+SCALE_NOTE_TEXT_CLASS),b=a.length-1,f=0;f<b;f++)if(this.isTriadMode?!this.triadsNotesShowPattern[f]:!this.normalNotesShowPattern[f]){var e=$(a[f]);e.toggleClass(TRANSPARENT_NOTE_CLASS,!0);0==f&&(e=$(a[b]),e.toggleClass(TRANSPARENT_NOTE_CLASS,!0))}$("."+SCALE_NOTES_CLASS,this.$itemBlock).on("click","."+SCALE_NOTE_CLASS,{itemThis:this},
this.onScaleNoteClick)};this.selectCurrentRootNote=function(){$("."+ROOT_NOTE_CLASS+"."+SELECTED_TEXT_CLASS,this.$itemBlock).toggleClass(SELECTED_TEXT_CLASS,!1);$("."+ROOT_NOTE_CLASS+":contains('"+this.root+"')",this.$itemBlock).first().toggleClass(SELECTED_TEXT_CLASS,!0)};this.onScaleChange=function(a){a=a.data.itemThis;var c=$(this).val().toLowerCase();isCorrectScale(c)&&(a.scale=c,a.semiTones=getScaleSemitones(c),a.scaleNotes=getNotesFromSemiTones(a.root,a.semiTones),a.putNotesOnAllStrings(),a.changeScaleNotesBlock(),
changeItemJSON(a),changeURLitemsParameters())};this.onStringTuneChange=function(a){var c=a.data.itemThis,b=$("."+STRINGS_OPTIONS_BLOCK_CLASS,a.data.itemThis.$itemBlock);a=$(this).val();b=$("."+STRING_TUNE_SELECT_CLASS,b).index(this);c.stringsTunes[b]=a;c.putNotesOnString(b);c.tuning=CUSTOM_TUNING_VALUE;c.selectCurrentTuning();changeItemJSON(c);changeURLitemsParameters()};this.onLeftArrowTuneClick=function(a){var c=a.data.itemThis;a=$("."+STRINGS_OPTIONS_BLOCK_CLASS,a.data.itemThis.$itemBlock);var b=
$("."+LEFT_ARROW_CLASS,a).index(this),e=c.stringsTunes[b],e=prevNote(e);c.stringsTunes[b]=e;$("."+STRING_TUNE_SELECT_CLASS+":eq("+b+") :contains('"+e+"')",a).prop("selected",!0);c.putNotesOnString(b);c.tuning=CUSTOM_TUNING_VALUE;c.selectCurrentTuning();changeItemJSON(c);changeURLitemsParameters()};this.onRightArrowTuneClick=function(a){var c=a.data.itemThis;a=$("."+STRINGS_OPTIONS_BLOCK_CLASS,a.data.itemThis.$itemBlock);var b=$("."+RIGHT_ARROW_CLASS,a).index(this),e=c.stringsTunes[b],e=nextNote(e);
c.stringsTunes[b]=e;$("."+STRING_TUNE_SELECT_CLASS+":eq("+b+") :contains('"+e+"')",a).prop("selected",!0);c.putNotesOnString(b);c.tuning=CUSTOM_TUNING_VALUE;c.selectCurrentTuning();changeItemJSON(c);changeURLitemsParameters()};this.onTuningChange=function(a){a=a.data.itemThis;var c=$(this).val().toLowerCase();c==CUSTOM_TUNING_VALUE?a.tuning=c:isCorrectTuning(c)&&(a.tuning=c,a.stringsTunes=getTuneNotes(c),a.moveTuning(a.halfStep),a.putNotesOnAllStrings(),a.selectCurrentStringsTunes());changeItemJSON(a);
changeURLitemsParameters()};this.onHalfStepChange=function(a){a=a.data.itemThis;var c=a.halfStep,b=$(this).val().replace(/[^-0-9]/gim,""),b=+b;a.halfStep=b;a.moveTuning(b-c);a.selectCurrentStringsTunes();a.putNotesOnAllStrings();changeItemJSON(a);changeURLitemsParameters()};this.onLeftArrowHalfStepClick=function(a){a=a.data.itemThis;var c=a.halfStep;c!=-MAX_HALF_STEP&&(c=prevHalfStep(c),a.halfStep=c,a.moveTuning(-1),a.selectCurrentStringsTunes(),a.putNotesOnAllStrings(),a.selectCurrentHalfStep(),
changeItemJSON(a),changeURLitemsParameters())};this.onRightArrowHalfStepCLick=function(a){a=a.data.itemThis;var c=a.halfStep;c!=MAX_HALF_STEP&&(c=nextHalfStep(c),a.halfStep=c,a.moveTuning(1),a.selectCurrentStringsTunes(),a.putNotesOnAllStrings(),a.selectCurrentHalfStep(),changeItemJSON(a),changeURLitemsParameters())};this.onRootNoteChange=function(a){a=a.data.itemThis;var c=$(this).text();isCorrectNote(c)&&(a.root=c.toUpperCase(),a.selectCurrentRootNote(),a.scaleNotes=getNotesFromSemiTones(a.root,
a.semiTones),a.changeScaleNotesBlock(),a.putNotesOnAllStrings(),changeItemJSON(a),changeURLitemsParameters())};this.onScaleNoteClick=function(a){a=a.data.itemThis;var c=$("."+SCALE_NOTE_CLASS,a.$itemBlock).index(this),c=c%a.scaleNotes.length,b;a.isTriadMode?(b=!a.triadsNotesShowPattern[c],a.triadsNotesShowPattern[c]=b):(b=!a.normalNotesShowPattern[c],a.normalNotesShowPattern[c]=b);0==c?(c=$("."+SCALE_NOTE_CLASS,a.$itemBlock).last().find("."+SCALE_NOTE_TEXT_CLASS),c.toggleClass(TRANSPARENT_NOTE_CLASS,
!b),c=$("."+SCALE_NOTE_CLASS,a.$itemBlock).first().find("."+SCALE_NOTE_TEXT_CLASS)):c=$(this).find("."+SCALE_NOTE_TEXT_CLASS);c.toggleClass(TRANSPARENT_NOTE_CLASS,!b);a.putNotesOnAllStrings();changeItemJSON(a);changeURLitemsParameters()};this.onAddStringButton=function(a){a=a.data.itemThis;var c=a.stringsNumber;c<MAX_STRINGS_NUMBER&&(a.addString(c),a.incStringsNumber(),changeItemJSON(a),changeURLitemsParameters())};this.onDelStringButton=function(a){a=a.data.itemThis;a.stringsNumber>MIN_STRINGS_NUMBER&&
(a.notesBlocks.pop(),a.delLastString(),a.decStringsNumber(),changeItemJSON(a),changeURLitemsParameters())};this.onCloseButton=function(a){a=a.data.itemThis;a.$itemBlock.hide(200,function(){$(this).remove()});deleteItem(a.id)};this.onSetDefaultButton=function(a){a=a.data.itemThis;defaultScaleItemOptions.scale=a.scale;defaultScaleItemOptions.root=a.root;defaultScaleItemOptions.semiTones=a.semiTones;defaultScaleItemOptions.tuning=a.tuning;defaultScaleItemOptions.halfStep=a.halfStep;defaultScaleItemOptions.stringsTunes=
a.stringsTunes;defaultScaleItemOptions.stringsNumber=a.stringsNumber;defaultScaleItemOptions.isTriadMode=a.isTriadMode;Cookies.set("defaultScaleOptions",defaultScaleItemOptions,{expires:DEFAULT_SCALE_OPTIONS_EXPIRE_DAYS})};this.onTriadsCheckboxClick=function(a){a=a.data.itemThis;a.isTriadMode?(a.isTriadMode=!1,a.$triadsCheckbox.hide(0),a.$triadsCheckboxEmpty.show(0)):(a.isTriadMode=!0,a.$triadsCheckboxEmpty.hide(0),a.$triadsCheckbox.show(0));a.changeScaleNotesBlock();a.putNotesOnAllStrings();changeItemJSON(a);
changeURLitemsParameters()};this.initStrings=function(){for(var a=0;a<FRETS_NUMBER;a++)this.$fretboardBlock.children().last().before(STRING_VER_FRET_TMPL());for(a=0;a<this.stringsNumber;a++)this.addString(a),this.$stringsNumberBlock.text(""+this.stringsNumber);this.selectCurrentStringsTunes()};this.readDefaultScaleItemOptions=function(){this.scale=defaultScaleItemOptions.scale;this.root=defaultScaleItemOptions.root;this.semiTones=getScaleSemitones(this.scale);this.scaleNotes=getNotesFromSemiTones(this.root,
this.semiTones);this.tuning=defaultScaleItemOptions.tuning;this.halfStep=defaultScaleItemOptions.halfStep;this.stringsTunes=defaultScaleItemOptions.stringsTunes;var a=defaultScaleItemOptions.stringsNumber;a<MIN_STRINGS_NUMBER&&(a=MIN_STRINGS_NUMBER);this.stringsNumber=a;this.isTriadMode=defaultScaleItemOptions.isTriadMode;this.normalNotesShowPattern=defaultScaleItemOptions.normalNotesShowPattern;this.triadsNotesShowPattern=defaultScaleItemOptions.triadsNotesShowPattern};this.getItemJSON=function(){var a=
{t:this.type,s:this.scale,r:this.root,tn:this.tuning,hs:this.halfStep,strt:this.stringsTunes,strn:this.stringsNumber,tr:this.isTriadMode,np:this.normalNotesShowPattern.slice(),tp:this.triadsNotesShowPattern.slice()};return JSON.stringify(a,semiTonesPatternBoolToInt)};this.setItemsFieldFromJSON=function(a){isCorrectScalesJSONfields(a)?(obj=JSON.parse(a,semiTonesPatternIntToBool),this.type=obj.t,this.scale=obj.s,this.root=obj.r,this.tuning=obj.tn,this.halfStep=obj.hs,this.stringsNumber=obj.strn,this.stringsTunes=
obj.strt,this.isTriadMode=obj.tr,this.normalNotesShowPattern=obj.np,this.triadsNotesShowPattern=obj.tp,this.semiTones=getScaleSemitones(this.scale),this.scaleNotes=getNotesFromSemiTones(this.root,this.semiTones)):(this.readDefaultScaleItemOptions(),changeItemJSON(this),changeURLitemsParameters())};this.initTriadsCheckbox=function(){this.$triadsCheckbox=$("."+TRIADS_CHECKBOX_CLASS,this.$itemBlock);this.$triadsCheckboxEmpty=$("."+TRIADS_CHECKBOX_EMPTY_CLASS,this.$itemBlock);this.isTriadMode?this.$triadsCheckboxEmpty.hide(0):
this.$triadsCheckbox.hide(0);this.$triadsCheckbox.click({itemThis:this},this.onTriadsCheckboxClick);this.$triadsCheckboxEmpty.click({itemThis:this},this.onTriadsCheckboxClick)};this.initAnimation=function(){this.$itemBlock.hide(0);this.$itemBlock.show(200)};this.init=function(){$addNewItemBtn.before(SCALES_ITEM_BLOCK_TMPL({id:this.id}));this.$itemBlock=$("#"+this.id);this.$stringsNumberBlock=$("."+STRING_NUMBER_CLASS,this.$itemBlock);this.$fretboardBlock=$("."+FRETBOARD_CLASS,this.$itemBlock);this.initAnimation();
b?this.setItemsFieldFromJSON(b):this.readDefaultScaleItemOptions();this.initStrings();this.initTriadsCheckbox();this.changeScaleNotesBlock();this.selectCurrentTuning();this.selectCurrentScale();this.selectCurrentHalfStep();this.selectCurrentRootNote();this.putNotesOnAllStrings();$("."+SCALE_SELECT_CLASS,this.$itemBlock).change({itemThis:this},this.onScaleChange);$("."+TUNING_SELECT_CLASS,this.$itemBlock).change({itemThis:this},this.onTuningChange);$("."+HALF_STEP_SELECT_CLASS,this.$itemBlock).change({itemThis:this},
this.onHalfStepChange);this.$itemBlock.find("."+HALF_STEP_BLOCK_CLASS).find("."+LEFT_ARROW_CLASS).click({itemThis:this},this.onLeftArrowHalfStepClick);this.$itemBlock.find("."+HALF_STEP_BLOCK_CLASS).find("."+RIGHT_ARROW_CLASS).click({itemThis:this},this.onRightArrowHalfStepCLick);$("."+SCALE_NOTES_BLOCK_CLASS,this.$itemBlock).on("click","."+ROOT_NOTE_CLASS,{itemThis:this},this.onRootNoteChange);$("."+ADD_STRING_BTN_CLASS,this.$itemBlock).click({itemThis:this},this.onAddStringButton);$("."+DEL_STRING_BTN_CLASS,
this.$itemBlock).click({itemThis:this},this.onDelStringButton);$("."+CLOSE_BTN_CLASS,this.$itemBlock).click({itemThis:this},this.onCloseButton);$("."+SET_DEFAULT_BTN_CLASS,this.$itemBlock).click({itemThis:this},this.onSetDefaultButton)};this.init()};var menuItems=[],usedIDs=[],itemsJSONs=[];function getIDforNewItem(){for(var a=0;0<=usedIDs.indexOf("menuItem"+a);)a++;return"menuItem"+a}function createNewItem(){var a=getIDforNewItem();menuItems.length<MAX_ITEMS_NUMBER?(menuItems.push(new ScalesItem(a)),usedIDs.push(a),itemsJSONs.push(menuItems[menuItems.length-1].getItemJSON()),changeURLitemsParameters()):$addNewItemBtn.hide(200)}
function createItemsFromURLparameters(){for(var a=0;a<itemsJSONs.length&&a<MAX_ITEMS_NUMBER;a++){var b=getIDforNewItem();menuItems.push(new ScalesItem(b,itemsJSONs[a]));usedIDs.push(b)}menuItems.length>=MAX_ITEMS_NUMBER&&$addNewItemBtn.hide(200)}function deleteItem(a){menuItems.length==MAX_ITEMS_NUMBER&&$addNewItemBtn.show(200);for(var b=0;b<menuItems.length;b++)menuItems[b].id===a&&(menuItems.splice(b,1),itemsJSONs.splice(b,1),usedIDs.splice(usedIDs.indexOf(a),1),changeURLitemsParameters())}
function changeURLitemsParameters(){for(var a="?",b=0;b<itemsJSONs.length;b++){var c=btoa(itemsJSONs[b]),a=a+("i"+b+"="+c);b<itemsJSONs.length-1&&(a+="&")}history.replaceState({},"",a)}function readURLitemsParameters(){var a=window.location.href,b=a.indexOf("?"),c=[];if(-1!=b)for(var a=a.slice(b+1).split("&"),d=0;d<a.length;d++)if(b=a[d].indexOf("="),-1!=b){b=a[d].slice(b+1);b=decodeURI(b);try{b=atob(b),c.push(b)}catch(f){console.log(PARAMS_ATOB_ERROR_MSG+"\n"+f)}}itemsJSONs=c}
function changeItemJSON(a){var b=$("."+ITEM_CLASS).index(a.$itemBlock);itemsJSONs[b]=a.getItemJSON()}function itemsInit(){readURLitemsParameters();0==itemsJSONs.length?createNewItem():createItemsFromURLparameters()}var $addNewItemBtn=$("#"+ADD_NEW_ITEM_BTN_ID);$addNewItemBtn.click(createNewItem);isMetronomeCanWork?metronome.init():$("#"+METRONOME_DISABLED_ID).show(0);getDefaultScaleOptionsFromCookie();itemsInit();
